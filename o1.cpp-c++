#include <opencv2/opencv.hpp>
#include <iostream>
#include <string>

using namespace cv;
using namespace std;

int main(int argc, char** argv) {
    // æ£€æŸ¥å‘½ä»¤è¡Œå‚æ•°
    if (argc != 3) {
        cout << "ä½¿ç”¨æ–¹æ³•: " << argv[0] << " <è¾“å…¥å›¾ç‰‡è·¯å¾„> <è¾“å‡ºå›¾ç‰‡è·¯å¾„>" << endl;
        cout << "ç¤ºä¾‹: " << argv[0] << " input.jpg grayscale_output.jpg" << endl;
        return -1;
    }

    string inputPath = argv[1];
    string outputPath = argv[2];

    // è¯»å–å›¾ç‰‡
    Mat colorImage = imread(inputPath);
    
    // æ£€æŸ¥å›¾ç‰‡æ˜¯å¦æˆåŠŸè¯»å–
    if (colorImage.empty()) {
        cout << "é”™è¯¯: æ— æ³•è¯»å–å›¾ç‰‡ " << inputPath << endl;
        cout << "è¯·æ£€æŸ¥:" << endl;
        cout << "1. æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®" << endl;
        cout << "2. æ–‡ä»¶æ˜¯å¦å­˜åœ¨" << endl;
        cout << "3. æ–‡ä»¶æ ¼å¼æ˜¯å¦æ”¯æŒ" << endl;
        return -1;
    }

    cout << "âœ… å›¾ç‰‡è¯»å–æˆåŠŸ: " << inputPath << endl;
    cout << "ğŸ“ åŸå§‹å›¾ç‰‡å°ºå¯¸: " << colorImage.cols << " x " << colorImage.rows << endl;
    cout << "ğŸ¨ é¢œè‰²é€šé“: " << colorImage.channels() << endl;

    // è½¬æ¢ä¸ºç°åº¦å›¾
    Mat grayscaleImage;
    cvtColor(colorImage, grayscaleImage, COLOR_BGR2GRAY);

    cout << "ğŸ”„ ç°åº¦è½¬æ¢å®Œæˆ" << endl;
    cout << "âš« ç°åº¦å›¾é€šé“: " << grayscaleImage.channels() << endl;

    // ä¿å­˜ç°åº¦å›¾
    bool isSuccess = imwrite(outputPath, grayscaleImage);
    
    if (isSuccess) {
        cout << "ğŸ’¾ ç°åº¦å›¾å·²ä¿å­˜: " << outputPath << endl;
        
        // æ˜¾ç¤ºå›¾ç‰‡ä¿¡æ¯
        cout << "\nğŸ“Š å›¾ç‰‡ä¿¡æ¯:" << endl;
        cout << "   æœ€å°åƒç´ å€¼: " << *min_element(grayscaleImage.begin<uchar>(), grayscaleImage.end<uchar>()) << endl;
        cout << "   æœ€å¤§åƒç´ å€¼: " << *max_element(grayscaleImage.begin<uchar>(), grayscaleImage.end<uchar>()) << endl;
        cout << "   æ•°æ®ç±»å‹: " << grayscaleImage.type() << " (CV_8UC1)" << endl;
    } else {
        cout << "âŒ ä¿å­˜å›¾ç‰‡å¤±è´¥: " << outputPath << endl;
        return -1;
    }

    return 0;
}
